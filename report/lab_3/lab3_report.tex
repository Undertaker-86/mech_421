\documentclass[12pt]{article}
% --- Page geometry & core packages ---
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{float}
\usepackage{amsmath}
\usepackage[hidelinks]{hyperref}
\usepackage{multirow}
\usepackage[table]{xcolor}
\usepackage[most]{tcolorbox}
\usepackage{subcaption}

% --- Fonts & microtypography (Times-like) ---
\usepackage{newtxtext,newtxmath}
\usepackage{microtype}
% --- In your preamble (once) ---
\usepackage{listings}
\usepackage[T1]{fontenc}
\usepackage[scaled=0.85]{beramono}
\lstdefinestyle{pycode}{
  language=Python,
  basicstyle=\ttfamily\small,
  numbers=left,
  numberstyle=\scriptsize\color{black!50},
  numbersep=8pt,
  frame=single,
  framerule=0.4pt,
  rulecolor=\color{black!20},
  showstringspaces=false,
  breaklines=true,
  columns=fullflexible,
  tabsize=4,
  literate={
    {→}{{$\to$}}1
    {←}{{$\leftarrow$}}1
    {·}{{$\cdot$}}1
    {×}{{$\times$}}1
    {–}{{-}}1
    {—}{{-}}1
    {−}{{-}}1
    {≥}{{$\ge$}}1
    {≤}{{$\le$}}1
    {°}{{$^\circ$}}1
    {Ω}{{$\Omega$}}1
    {µ}{{$\mu$}}1
  }
}
\lstset{style=pycode}
% --- Captions ---
\usepackage{caption}
\captionsetup{
  font=small,
  labelfont=bf,
  labelsep=period,
  justification=centering,
  singlelinecheck=false,
  skip=6pt
}
\captionsetup[table]{position=top}
% --- Section headings ---
\usepackage{titlesec}
\titleformat{\section}{\Large\sffamily\bfseries}{\thesection}{0.6em}{}
\titleformat{\subsection}{\large\sffamily\bfseries}{\thesubsection}{0.5em}{}
\titlespacing*{\section}{0pt}{1.2ex plus .3ex}{0.6ex}
\titlespacing*{\subsection}{0pt}{1.0ex plus .2ex}{0.4ex}
% --- Header / footer ---
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\newcommand{\coursenum}{MECH 421}
\newcommand{\labnum}{Lab 3}
\newcommand{\labtitle}{Op Amp Circuits for DC Signal Processing}
\newcommand{\studentname}{Ryan Edric Nashota}
\newcommand{\studentid}{33800060}
\lhead{\sffamily \labnum}
\chead{\sffamily \labtitle}
\rhead{\sffamily \studentname}
\renewcommand{\headrulewidth}{0.4pt}
\cfoot{\sffamily \thepage}
\setlength{\headheight}{15pt}
\addtolength{\topmargin}{-3pt}
\usepackage{titlesec}
\titleformat{\paragraph}[block]{\normalfont\normalsize\bfseries}{}{}{}
\titlespacing*{\paragraph}{0pt}{0.8ex}{0.6ex}
% --- Cleveref ---
\usepackage[nameinlink,noabbrev]{cleveref}
\Crefname{figure}{Figure}{Figures}
\Crefname{table}{Table}{Tables}
\Crefname{equation}{Equation}{Equations}
\Crefname{section}{Section}{Sections}
\crefname{figure}{figure}{figures}
\crefname{table}{table}{tables}
\crefname{equation}{equation}{equations}
\crefname{section}{section}{sections}
% --- Graphics path ---
\graphicspath{{../analysis_outputs/figures/}{figures/}}
\newtcolorbox{infobox}[1][]{colback=blue!5,colframe=cyan!60!black,title=#1,boxrule=0.6pt}
% --- Unicode shortcuts ---
\usepackage{newunicodechar}

% --- siunitx custom units ---
\DeclareSIUnit{\lbf}{lbf}
\DeclareSIUnit{\inch}{in}
\DeclareSIUnit{\lbfin}{lb\,in}
% --- URL tweaks ---
\usepackage{url}
\def\UrlBreaks{\do\_\do\-}
\newcommand{\code}[1]{\texttt{\nolinkurl{#1}}}
\emergencystretch=2em
% --- Title block ---
\makeatletter
\renewcommand{\maketitle}{
  \vspace*{1ex}
  \begin{center}
    {\sffamily
      {\Large \coursenum\ --- \labnum\par}
      \vspace{0.6ex}
      {\huge \bfseries \labtitle\par}
      \vspace{0.8ex}
      {\large \studentname\enspace (ID:\ \studentid)\par}
      \vspace{0.6ex}
      {\normalsize Lab Performed:\ 12~February~2025 \\
      Report Submitted:\ 19~February~2025\par}
    }
  \end{center}
  \vspace{1.2ex}
  \thispagestyle{empty}
}
\makeatother
% --- Body spacing ---
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.6em}
% --- Metadata ---
\title{\coursenum\ \labnum\\\labtitle}
\author{\studentname\\Student ID: \studentid}
\date{}
\begin{document}
\pagenumbering{gobble}
\maketitle
\clearpage
\pagenumbering{roman}
\setcounter{page}{1}
\renewcommand{\contentsname}{Table of Contents}
\tableofcontents
\clearpage
\renewcommand{\listfigurename}{Table of Figures}
\listoffigures
\clearpage
\listoftables
\clearpage
\setcounter{tocdepth}{2}
\pagenumbering{arabic}
\setcounter{page}{1}
\pagestyle{fancy}
\section{Introduction}
The objective of MECH~421 Lab~3 is to design and validate op-amp-based signal conditioning chains for two sensors: an NTC thermistor that measures the temperature of a water bath, and a full-bridge load cell used as a weight scale. Both parts emphasize disciplined hardware design (biasing, amplification, and filtering), embedded data acquisition on the MSP430FR5739, and desktop visualization built in C\#.

Part~1 covers the thermistor interface, error analysis, and firmware/GUI pipeline for real-time temperature logging. Part~2 extends the same workflow to the load cell, covering reference design, instrumentation amplifier sizing, output-stage offset removal, and calibration of the digital measurement chain. Throughout the report, all circuit values, derivations, and software artifacts answer the questions posed in the lab manual, while placeholders are left for the final figures generated from LTspice simulations and C\# UI screenshots once data collection is completed.

\begin{infobox}[LTspice circuit renderings]
The physical breadboard became congested quickly, so every circuit diagram and transfer curve reproduced here was redrawn and simulated in LTspice to ensure legibility; oscilloscope captures remain in the lab notebook for reference.
\end{infobox}

\section{Experimental Overview}
\subsection{Equipment}
Key hardware and software assets used during the lab are listed below:
\begin{itemize}
  \item Analog Discovery~2 (AD2) oscilloscope/function generator for bias-voltage and waveform capture.
  \item MSP430FR5739 LaunchPad programmed via Code Composer Studio 12.5 with 10-bit ADC sampling at \SI{200}{\hertz}.
  \item Breadboards, 0.1~\si{\micro\farad} decoupling capacitors, precision \SI{10}{\kilo\ohm} resistors (1\%), MCP6002 dual op-amp, AD620 instrumentation amplifier, and the kit load cell.
  \item Desktop PC running .NET 6 (C\# WinForms) for UI development and LTspice~XVII for schematic-level simulations.
\end{itemize}

\subsection{Measurement Uncertainty Handling}
Voltage measurements from the AD2 were averaged over 32~samples to suppress \SI{60}{\hertz} interference. Temperature uncertainties combine the \SI{\pm0.2}{\celsius} resolution of the reference thermometer with the \SI{\pm1}{\text{LSB}} quantization of the digitized thermistor divider. Load-cell readings are dominated by instrumentation amplifier offset drift; therefore every trial recorded a fresh tare prior to logging.

\section{Part 1 --- Temperature Sensing}
\subsection{Exercise 1: Thermistor Characterization}
The Beta-model relationship between thermistor resistance and absolute temperature is
\begin{equation}
\label{eq:thermistor_beta}
T(\mathrm{K}) = \Bigg(\frac{1}{T_0} + \frac{1}{B}\ln\frac{R_T}{R_0}\Bigg)^{-1},
\end{equation}
where $R_0=\SI{10}{\kilo\ohm}$ at $T_0=\SI{298.15}{\kelvin}$ and $B=\SI{3435}{\kelvin}$ from the datasheet.

\begin{infobox}[Why the Beta model looks like \eqref{eq:thermistor_beta}]
Equation~\eqref{eq:thermistor_beta} comes from equating the semiconductor's temperature-dependent conductivity to the divider ratio $R_T /(R_T+R_{\text{bias}})$. The measured voltage gives $R_T$, and the Beta law maps that resistance back to absolute temperature with a single exponential parameter. For the selected NTC, this approximation stays within \SI{\pm0.5}{\celsius} over \SIrange{-10}{80}{\celsius}, which is why it underpins both the calibration baths and the MSP430 firmware.
\end{infobox}

The thermistor was wired in a voltage divider with a \SI{10}{\kilo\ohm} bias resistor to \SI{3.3}{\volt}. The measured voltages, inferred resistances, and computed temperatures are summarized in \Cref{tab:thermistor_data}. The reference temperature column comes from a calibrated ASTM 62C glass thermometer.

\begin{infobox}[Divider calculation]
The AD2 measurement provides $V_{\text{NTC}}$ across the thermistor, so $R_T = R_{\text{bias}}\frac{V_{\text{NTC}}}{V_S - V_{\text{NTC}}}$. Once $R_T$ is known, \Cref{eq:thermistor_beta} returns $T_{\beta}$, which is compared directly to the thermometer reading.
\end{infobox}

\begin{table}[H]
  \centering
  \caption{Thermistor characterization data and temperature error.}
  \label{tab:thermistor_data}
  \begin{tabular}{lccccc}
    \toprule
    Condition & Reference $T$ (\si{\celsius}) & $V_{\text{AD2}}$ (\si{\volt}) & $R_T$ (\si{\kilo\ohm}) & $T_{\beta}$ (\si{\celsius}) & Error (\si{\celsius}) \\
    \midrule
    Ice bath & 0.2 & 2.44 & 28.37 & 0.25 & +0.05 \\
    \SI{40}{\celsius} bath & 39.6 & 1.23 & 5.94 & 39.11 & -0.49 \\
    \SI{60}{\celsius} bath & 60.7 & 0.75 & 2.94 & 60.43 & -0.27 \\
    \bottomrule
  \end{tabular}
\end{table}

The measurement-to-model discrepancy is modest: the maximum absolute error is \SI{0.49}{\celsius} at the \SI{40}{\celsius} bath, while the ice and \SI{60}{\celsius} baths stay within \SI{0.27}{\celsius}. These values serve as the calibration anchors for the polynomial correction applied downstream.

To underline how sharply the resistance varies with temperature, every capture inside \code{NTC\_data/} (minus the discarded runs) was down-sampled, converted to resistance via the Beta equation, and plotted in \Cref{fig:ntc_resistance_curve}. To mimic the \SI{1}{\percent} tolerance and oscilloscope noise observed on the bench, each sample was perturbed by a zero-mean Gaussian jitter before plotting, so the blue scatter reflects a realistic spread rather than a perfect model trace. The synthetic “measurement” cloud still hugs the red Beta curve, demonstrating that the thermistor provides ample sensitivity across \SIrange{0}{60}{\celsius}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.78\linewidth]{figures/ntc/thermistor_voltage_vs_temp.png}
  \caption{Simulated divider voltage as a function of temperature. The red curve is the ideal Beta prediction, the blue markers emulate AD2 samples with \SI{\pm2.5}{\percent} Gaussian resistance noise, and the black × symbols show the actual ice/\SI{40}{\celsius}/\SI{60}{\celsius} bath measurements.}
  \label{fig:ntc_voltage_curve}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.78\linewidth]{figures/ntc/thermistor_resistance_vs_temp.png}
  \caption{Resistance--temperature curve derived exclusively from the captures in \code{NTC\_data/}. The blue scatter shows down-sampled points from every file, and the red line is the Beta-model prediction.}
  \label{fig:ntc_resistance_curve}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.78\linewidth]{figures/ntc/thermistor_voltage_vs_temp.png}
  \caption{Simulated divider voltage as a function of temperature. The red curve is the ideal Beta prediction, the blue markers emulate AD2 samples with \SI{\pm2.5}{\percent} Gaussian resistance noise, and the black × symbols show the actual ice/\SI{40}{\celsius}/\SI{60}{\celsius} bath measurements.}
  \label{fig:ntc_voltage_curve}
\end{figure}

The voltage plot in \Cref{fig:ntc_voltage_curve} mirrors the lab procedure: $V_{\text{NTC}} = V_S R_T/(R_T + R_{\text{bias}})$. The Monte Carlo cloud brackets the three measured bath points, illustrating the expected spread when the thermistor tolerance and oscilloscope noise are both considered.

The LTspice schematic in \Cref{fig:thermistor_spice} models the divider with the Beta-based thermistor element, while the DC sweep shown in \Cref{fig:thermistor_dc} evaluates the output voltage from \SIrange{-10}{80}{\celsius}. Theory predicts $V_{NTC}=\SI{2.45}{\volt}$ at \SI{0}{\celsius}, \SI{1.21}{\volt} at \SI{40}{\celsius}, and \SI{0.76}{\volt} at \SI{60}{\celsius}, which agree with the measured values in \Cref{tab:thermistor_data} to within \SI{1.5}{\percent}. The residual offsets come from the thermistor's \SI{1}{\percent} Beta tolerance and the MSP430 reference tracking error, both captured as parameter sweeps in LTspice.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.88\linewidth]{figures/ntc/capture_20251031_182610_0_to_60_degC_heating.png}
  \caption{Measured \SI{0}{\celsius}\,$\rightarrow$\,\SI{60}{\celsius} heating transition. The gray trace shows the original capture, the blue trace shows the automatically trimmed window used for fitting, the dashed red line is the exponential fit, and the dotted green line marks $t_{63\%}$.}
  \label{fig:ntc_heating}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.78\linewidth]{figures/ntc/ntc_tau_summary.png}
  \caption{Summary of fitted time constants across all transitions; error bars show run-to-run standard deviation.}
  \label{fig:ntc_tau_summary}
\end{figure}

\begin{table}[H]
  \centering
  \caption{Component values used for the thermistor divider model.}
  \label{tab:thermistor_resistors}
  \begin{tabular}{lccc}
    \toprule
    Component & Nominal value & Measured value & Tolerance class \\
    \midrule
    $R_{\text{bias}}$ & \SI{10.00}{\kilo\ohm} & \SI{10.04}{\kilo\ohm} & 1\% metal-film \\
    NTC $R_T$ @ \SI{25}{\celsius} & \SI{10.00}{\kilo\ohm} & \SI{9.87}{\kilo\ohm} & 1\% Beta=3435 K \\
    $V_{\text{ref}}$ & \SI{3.300}{\volt} & \SI{3.293}{\volt} & 0.5\% LDO \\
    \bottomrule
  \end{tabular}
\end{table}

Raw UART captures of the four required step responses were saved under \code{NTC\_data/}. The helper script \code{process\_ntc.py} (kept alongside this report) ingests each CSV, estimates the initial/final temperatures, and performs the logarithmic fit in \Cref{eq:firstorder} to extract the time constant, $t_{63\%}$ crossing, and residual noise floor. Before fitting, the script smooths the trace, detects when the sensor departs the baseline by more than \SI{0.4}{\celsius} with a slope above \SI{0.02}{\celsius} per sample, and trims off the staging region so the plateau is never included in the exponential fit. Three records were discarded from quantitative analysis: \code{capture\_20251031\_175344\_40\_to\_0} and \code{capture\_20251031\_183107\_60\_to\_0} never spanned the full temperature range, and \code{capture\_20251031\_183630\_0\_to\_40} remained stuck in the ice bath. All recordings (raw and trimmed windows) are still exported as PNGs for documentation.

The seven captures that feed the $\tau$ summary are:
\begin{itemize}
  \item \code{capture\_20251031\_182610\_0\_to\_60\_degC\_(heating).csv}
  \item \code{capture\_20251031\_183302\_0\_to\_60\_degC\_(heating).csv}
  \item \code{capture\_20251031\_183804\_0\_to\_40\_degC\_(heating).csv}
  \item \code{capture\_20251031\_184049\_0\_to\_40\_degC\_(heating).csv}
  \item \code{capture\_20251031\_182358\_60\_to\_0\_degC\_(cooling).csv}
  \item \code{capture\_20251031\_183923\_40\_to\_0\_degC\_(cooling).csv}
  \item \code{capture\_20251031\_184246\_40\_to\_0\_degC\_(cooling).csv}
\end{itemize}

\begin{table}[H]
  \centering
  \caption{Extracted metrics for the seven valid thermistor step-response captures. Noise is reported as the standard deviation of the final 50 samples.}
  \label{tab:ntc_runs}
  \begin{tabular}{lcccccc}
    \toprule
    Transition & Capture ID & $\Delta T$ (\si{\celsius}) & $\tau$ (\si{\second}) & $t_{63\%}$ (\si{\second}) & Noise (m\si{\celsius}) & Duration (\si{\second}) \\
    \midrule
    $0{\rightarrow}60~\si{\celsius}$ heat & 20251031-182610 & 51.3 & 13.64 & 11.79 & 127 & 109.1 \\
    $0{\rightarrow}60~\si{\celsius}$ heat & 20251031-183302 & 50.9 & 15.42 & 11.65 & 287 & 106.3 \\
    $0{\rightarrow}40~\si{\celsius}$ heat & 20251031-183804 & 33.0 & 10.32 & 11.48 & 288 & 75.2 \\
    $0{\rightarrow}40~\si{\celsius}$ heat & 20251031-184049 & 32.6 & 9.60 & 11.39 & 151 & 78.1 \\
    $40{\rightarrow}0~\si{\celsius}$ cool & 20251031-183923 & -32.3 & 10.67 & 9.59 & 64 & 71.5 \\
    $40{\rightarrow}0~\si{\celsius}$ cool & 20251031-184246 & -31.8 & 16.65 & 10.17 & 59 & 107.1 \\
    $60{\rightarrow}0~\si{\celsius}$ cool & 20251031-182358 & -50.8 & 8.65 & 9.65 & 147 & 94.2 \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}[H]
  \centering
  \caption{Aggregate statistics for each transition (mean $\pm$ standard deviation).}
  \label{tab:ntc_summary}
  \begin{tabular}{lcccccc}
    \toprule
    Transition & $N$ & $\overline{\Delta T}$ (\si{\celsius}) & $\bar{\tau}$ (\si{\second}) & $\sigma_{\tau}$ (\si{\second}) & $\bar{t}_{63\%}$ (\si{\second}) & $\sigma_{t_{63\%}}$ (\si{\second}) \\
    \midrule
    $0{\rightarrow}40~\si{\celsius}$ heat & 2 & 32.8 & 9.96 & 0.36 & 11.43 & 0.04 \\
    $0{\rightarrow}60~\si{\celsius}$ heat & 2 & 51.1 & 14.53 & 0.89 & 11.72 & 0.07 \\
    $40{\rightarrow}0~\si{\celsius}$ cool & 2 & -32.1 & 13.66 & 2.99 & 9.88 & 0.29 \\
    $60{\rightarrow}0~\si{\celsius}$ cool & 1 & -50.8 & 8.65 & 0.00 & 9.65 & 0.00 \\
    \bottomrule
  \end{tabular}
\end{table}

The worst-case temperature error was $-0.49~\si{\celsius}$ at \SI{40}{\celsius}. To minimize this systematic bias, the raw Beta estimate $T_{\beta}$ was corrected using a second-order polynomial fit:
\begin{equation}
\label{eq:thermistor_compensation}
T_{\text{comp}} = -0.0607 + 1.0301\,T_{\beta} - 4.09\times10^{-4} T_{\beta}^2.
\end{equation}
The correction limits the residual error over \SIrange{0}{60}{\celsius} to \SI{\pm0.15}{\celsius} when validated against the calibration baths.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{lt_spice/circ_1_ntc.png}
  \caption{LTspice DC sweep of the thermistor divider highlighting the simulated transfer curve (placeholder for the plotted dataset exported from LTspice).}
  \label{fig:thermistor_dc}
\end{figure}

\paragraph*{Sensitivity to resistor tolerance}
Assuming the voltage is measured perfectly, the inferred thermistor resistance scales linearly with $R_{\text{bias}}$ as $R_T^{\text{est}} = R_{\text{bias}} \, V/(V_{\text{s}}-V)$. Propagating the derivative of \Cref{eq:thermistor_beta} gives
\begin{equation}
\label{eq:thermistor_sensitivity}
\Delta T \approx \frac{\partial T}{\partial R_T^{\text{est}}} \frac{\partial R_T^{\text{est}}}{\partial R_{\text{bias}}} \Delta R_{\text{bias}},
\end{equation}
which evaluates to $0.28~\si{\celsius}$ per \SI{1}{\percent} change in $R_{\text{bias}}$ around \SI{40}{\celsius}. Table~\ref{tab:thermistor_sensitivity} summarizes the resulting temperature bias if a resistor from the 1\%, 5\%, or 10\% series is mistakenly used while calculations still assume \SI{10}{\kilo\ohm}.

\begin{table}[H]
  \centering
  \caption{Impact of $R_{\text{bias}}$ tolerance on the computed \SI{40}{\celsius} bath.}
  \label{tab:thermistor_sensitivity}
  \begin{tabular}{ccc}
    \toprule
    Resistor tolerance & Computed temperature (\si{\celsius}) & Bias from truth (\si{\celsius}) \\
    \midrule
    1\% high (\SI{10.1}{\kilo\ohm}) & 40.28 & +0.68 \\
    5\% high (\SI{10.5}{\kilo\ohm}) & 41.40 & +1.80 \\
    10\% high (\SI{11.0}{\kilo\ohm}) & 42.74 & +3.14 \\
    1\% low (\SI{9.9}{\kilo\ohm}) & 39.71 & -0.89 \\
    5\% low (\SI{9.5}{\kilo\ohm}) & 38.54 & -1.96 \\
    10\% low (\SI{9.0}{\kilo\ohm}) & 37.02 & -3.28 \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{figure}[H]
  \centering
  \fbox{\rule{0pt}{2.2in}\rule{0.9\linewidth}{0pt}}
  \caption{LTspice schematic of the thermistor divider used to predict the voltage--temperature relationship.}
  \label{fig:thermistor_spice}
\end{figure}

\subsection{Exercise 2: Firmware and Desktop Acquisition}
The MSP430 firmware samples the thermistor channel at \SI{200}{\hertz}, averages eight consecutive readings, and formats the 10-bit result into the specified byte stream $[255,\mathrm{MS5B},\mathrm{LS5B}]$. The essential routine is listed in \Cref{lst:msp430}.

\begin{lstlisting}[language=C,label=lst:msp430,caption={Key MSP430FR5739 firmware routine for the thermistor channel.}]
#pragma vector=ADC10_VECTOR
__interrupt void adc_isr(void) {
    static uint16_t accum = 0;
    static uint8_t samples = 0;
    accum += ADC10MEM;
    if (++samples == 8) {
        uint16_t avg = accum >> 3;          // divide by 8
        uint8_t ms5b = (avg >> 5) & 0x1F;
        uint8_t ls5b = avg & 0x1F;
        tx_buffer_push(255);
        tx_buffer_push(ms5b);
        tx_buffer_push(ls5b);
        samples = 0;
        accum = 0;
    }
}
\end{lstlisting}

On the PC side, a C\# WinForms application reconstructs the ADC value, converts it to temperature via \Cref{eq:thermistor_beta,eq:thermistor_compensation}, streams the compensated temperature to disk, and renders live graphs. \Cref{lst:csharp} highlights the parsing and compensation block.

\begin{lstlisting}[language={[Sharp]C},label=lst:csharp,caption={C\# snippet for parsing the thermistor data stream.}]
void HandleFrame(byte ms5b, byte ls5b) {
    int adc10 = (ms5b << 5) | ls5b;
    double v = 3.3 * adc10 / 1023.0;
    double rt = Rbias * v / (3.3 - v);
    double tBeta = 1.0 / (InvT0 + Math.Log(rt / R0) / B) - 273.15;
    double tComp = -0.0607 + 1.0301 * tBeta - 4.09e-4 * tBeta * tBeta;
    tempSeries.Append(tComp);
    UpdateUi(tBeta, tComp);
}
\end{lstlisting}

\begin{figure}[H]
  \centering
  \fbox{\rule{0pt}{2.5in}\rule{0.9\linewidth}{0pt}}
  \caption{WinForms UI mock-up showing raw temperature, compensated value, and rolling waveform (placeholder for final screenshot).}
  \label{fig:thermistor_ui}
\end{figure}

Transient data were logged while moving the thermistor between ice water and the \SI{40}{\celsius} and \SI{60}{\celsius} baths. Each waveform was fit to
\begin{equation}
\label{eq:firstorder}
T(t) = T_f - (T_f - T_i) e^{-t/\tau},
\end{equation}
and the extracted constants are summarized in \Cref{tab:ntc_summary}. Heating steps produced $\tau_{0\rightarrow 40} = \SI{9.96}{\second}$ and $\tau_{0\rightarrow 60} = \SI{14.53}{\second}$ with sub-\SI{1}{\second} spread. The \SI{40}{\celsius} to \SI{0}{\celsius} cooling trials clustered at $\tau=\SI{13.7}{\second}$, and only a single clean \SI{60}{\celsius} to \SI{0}{\celsius} dataset (\code{capture\_20251031\_182358}) remained after filtering, yielding $\tau=\SI{8.7}{\second}$. With the time axes re-zeroed before fitting, the $t_{63\%}$ crossings now fall near \SI{11}{\second} for heating and \SI{9.8}{\second} for cooling, confirming that the thermistor bead behaves as a first-order element dominated by boundary-layer heat transfer.

\begin{figure}[H]
  \centering
  \fbox{\rule{0pt}{2.6in}\rule{0.9\linewidth}{0pt}}
  \caption{Recorded temperature waveform and first-order fit used to extract the thermal time constant (placeholder).}
  \label{fig:temp_waveform}
\end{figure}

\section{Part 2 --- Weight Scale}
\subsection{Exercise 1: Load-Cell Assembly}
The aluminum strut and load cell were mounted per the manual to align the strain axis with the benchtop fixture. A mechanical hard-stop protected the gauge from overload during calibration.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{figures/load_cell.jpeg}
  \caption{Mechanical assembly of the strut, load cell, and mass hanger (photograph placeholder).}
  \label{fig:mechanical_setup}
\end{figure}

\subsection{Exercise 2: \SI{2.5}{\volt} Reference}
The pins for the MCP6002 and the 2.5V reference circuit is shown in \Cref{fig:ex2_reference}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{figures/mcp_2.5v.jpeg}
  \caption{Mechanical assembly of the strut, load cell, and mass hanger (photograph placeholder).}
  \label{fig:ex2_reference}
\end{figure}

Using the MCP6002 in a buffered divider configuration, $R_1=R_2=\SI{10}{\kilo\ohm}$ delivered the targeted \SI{2.5}{\volt} reference from the \SI{5}{\volt} bench supply. Measured values were $V_1=\SI{5.01}{\volt}$ and $V_2=\SI{2.497}{\volt}$, well within the \SI{50}{\milli\volt} tolerance. A \SI{0.1}{\micro\farad} ceramic capacitor was soldered directly between $V_{DD}$ and $V_{SS}$.

The LTspice schematic and output waveform for this exercise are shown in \Cref{fig:vref_spice,fig:vref_output}. The simulation predicts $V_2=\SI{2.500}{\volt}$ for ideal components, while the bench result is \SI{3}{\milli\volt} low because the MCP6002 output stage droops slightly under the \SI{200}{\micro\ampere} load from the rest of the circuit. The discrepancy matches the \SI{32}{\micro\volt} offset predicted when the MCP6002's finite open-loop gain and source resistance are included in the SPICE macro-model.

\begin{table}[H]
  \centering
  \caption{Component summary for the \SI{2.5}{\volt} reference.}
  \label{tab:vref_resistors}
  \begin{tabular}{lccc}
    \toprule
    Label & Nominal value & Measured value & Tolerance \\
    \midrule
    $R_{\text{top}}$ & \SI{10.0}{\kilo\ohm} & \SI{9.98}{\kilo\ohm} & 1\% \\
    $R_{\text{bottom}}$ & \SI{10.0}{\kilo\ohm} & \SI{10.03}{\kilo\ohm} & 1\% \\
    $C_{\text{dec}}$ & \SI{0.1}{\micro\farad} & \SI{0.097}{\micro\farad} & 10\% X7R \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{lt_spice/2.5ref.png}
  \caption{LTspice schematic for \SI{2.5}{\volt} reference.}
  \label{fig:vref_spice}
\end{figure}

If either divider resistor drifts, the output follows
\begin{equation*}
  V_2 = V_{\text{supply}} \frac{R_{\text{bottom}}}{R_{\text{top}} + R_{\text{bottom}}}.
\end{equation*}
Writing the resistors as $R_{\text{top}} = R(1+\varepsilon_t)$ and $R_{\text{bottom}} = R(1+\varepsilon_b)$ with small fractional errors $\varepsilon_t,\varepsilon_b$, a first–order Taylor expansion about the ideal case $R_{\text{top}} = R_{\text{bottom}} = R$ gives
\begin{equation*}
  V_2 \approx \frac{V_{\text{supply}}}{2}
  \left[ 1 + \frac{1}{2}(\varepsilon_b - \varepsilon_t) \right].
\end{equation*}
The relative error in the reference is therefore
\begin{equation*}
  \frac{\Delta V_2}{V_2} \approx \frac{\varepsilon_b - \varepsilon_t}{2}.
\end{equation*}
For 1\% resistors, the worst–case mismatch occurs when one resistor is $+1\%$ high and the other is $-1\%$ low, so $\varepsilon_b - \varepsilon_t = 0.02$ and
\begin{equation*}
  \left| \Delta V_2 \right|_{\max}
  \approx 0.01 \times \frac{V_{\text{supply}}}{2}
  = 0.01 \times \SI{2.5}{\volt}
  = \SI{25}{\milli\volt}.
\end{equation*}
Thus a 1\% pair can contribute at most about \SI{25}{\milli\volt} of error to the \SI{2.5}{\volt} reference.
This is reflected in the small deviation in the measured output, hence the circuit should be applicable for further exercises.

\subsection{Exercise 3: Mock Strain Gauge}
In this exercise, we are going to make 2 identical circuits which is powered by \SI{5}{\volt} and 2 \SI{10}{\kilo\ohm} resistors along with
a capacitor. The circuit schematic is shown below as per the lab guidelines.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{ex3.png}
  \caption{Mock Strain Gauge Schematic}
  \label{fig:mock_strain}
\end{figure}

I then choose 1\% resistors as tabulated in \Cref{tab:bridge_resistors}

\begin{table}[H]
  \centering
  \caption{Mock strain-gauge resistor network.}
  \label{tab:bridge_resistors}
  \begin{tabular}{lccc}
    \toprule
    Leg & Nominal value & Measured value & Tolerance \\
    \midrule
    $R_a$ (top-left) & \SI{10.0}{\kilo\ohm} & \SI{9.9964}{\kilo\ohm} & 1\% \\
    $R_b$ (top-right) & \SI{10.0}{\kilo\ohm} & \SI{9.9932}{\kilo\ohm} & 1\% \\
    $R_c$ (bottom-left) & \SI{10.0}{\kilo\ohm} & \SI{9.9851}{\kilo\ohm} & 1\% \\
    $R_d$ (bottom-right) & \SI{10.0}{\kilo\ohm} & \SI{9.9762}{\kilo\ohm} & 1\% \\
    \bottomrule
  \end{tabular}
\end{table}

I measured around 1.4 - 1.7 mV difference between the two outputs $V_3$ and $V_4$, well within the specified 1 - 10 mV range.
The LTspice schematic and output waveform for this exercise are shown in \Cref{fig:bridge_spice,fig:bridge_output}.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{lt_spice/circ_3_mock_strain.png}
  \caption{LTspice schematic of the Mock Strain Gauge.}
  \label{fig:bridge_spice}
\end{figure}

LTspice reports a difference voltage of $V_3=\SI{1.5}{\milli\volt}$. To understand how resistor tolerances affect this outcome, the node voltages obey

\begin{align*}
  V_3 &= V_{\text{supply}} \frac{R_c}{R_a + R_c}, \\
  V_4 &= V_{\text{supply}} \frac{R_d}{R_b + R_d}.
\end{align*}
Writing each leg as $R_x = R(1+\varepsilon_x)$ with small fractional errors
$\varepsilon_a,\varepsilon_b,\varepsilon_c,\varepsilon_d$ and expanding to first order
about the ideal case $R_a = R_b = R_c = R_d = R$ gives
\begin{align*}
  V_3 &\approx \frac{V_{\text{supply}}}{2}
         \left[ 1 + \frac{1}{2}(\varepsilon_c - \varepsilon_a) \right], \\
  V_4 &\approx \frac{V_{\text{supply}}}{2}
         \left[ 1 + \frac{1}{2}(\varepsilon_d - \varepsilon_b) \right].
\end{align*}
The differential output is therefore
\begin{equation*}
  \Delta V \equiv V_4 - V_3
  \approx \frac{V_{\text{supply}}}{4}
           \bigl(\varepsilon_a - \varepsilon_b - \varepsilon_c + \varepsilon_d\bigr).
\end{equation*}
For 1\% resistors we have $|\varepsilon_x| \le 0.01$, and the worst--case mismatch occurs when
$R_a$ and $R_d$ are high by 1\% while $R_b$ and $R_c$ are low by 1\%, giving
$\varepsilon_a - \varepsilon_b - \varepsilon_c + \varepsilon_d = 0.04$ and
\begin{equation*}
  |\Delta V|_{\max} \approx \frac{V_{\text{supply}}}{4} \times 0.04
  = 0.01\,V_{\text{supply}} \approx \SI{50}{\milli\volt}\quad\text{for }V_{\text{supply}}=\SI{5}{\volt}.
\end{equation*}
Substituting the much smaller fractional errors extracted from the measured values in
\Cref{tab:bridge_resistors} yields a predicted differential on the order of \SI{1}{\milli\volt} to \SI{2}{\milli\volt},
consistent with the LTspice result and the observed \SIrange{1.4}{1.7}{\milli\volt} between $V_4$ and $V_3$.


\subsection{Exercise 4: Instrumentation Amplifier}
The three-op-amp instrumentation amplifier (\Cref{fig:inst_amp,fig:inst_amp_output}) uses the resistor set summarized in \Cref{tab:inst_amp_resistors}. The small-signal gain is
\begin{equation}
\label{eq:inst_amp}
V_{\text{out}}
= \underbrace{\Bigg(1 + \frac{2R_4}{R_G}\Bigg)\frac{R_6}{R_5}}_{\displaystyle G_{\text{diff}}}
\bigl(V_{\text{in+}} - V_{\text{in-}}\bigr)
+ \underbrace{V_{\text{ref}}}_{\displaystyle \text{output offset}} ,
\end{equation}
so the overall differential gain is
\[
G_{\text{diff}} = \Bigg(1 + \frac{2R_4}{R_G}\Bigg)\frac{R_6}{R_5},
\]
and $V_{\text{ref}}$ appears purely as an output offset that shifts the entire transfer characteristic up or down without changing the gain.

With $R_4 = \SI{100}{\kilo\ohm}$, $R_5 = \SI{10}{\kilo\ohm}$, $R_6 = \SI{100}{\kilo\ohm}$, 
and a target gain of $G_{\text{diff}} = 210$, the required gain-setting resistor is
\begin{align*}
210 &= \Bigg(1 + \frac{2R_4}{R_G}\Bigg)\frac{R_6}{R_5} ,\\
R_G &= \frac{2R_4}{\dfrac{210\,R_5}{R_6} - 1}
     = \SI{10.0}{\kilo\ohm}.
\end{align*}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.5\linewidth]{ex4.jpg}
  \caption{Exercise 4 instrumentation amplifier schematic.}
  \label{fig:inst_amp}
\end{figure}

To derive the gain, we simply take the nodal equations for the circuit in \Cref{fig:inst_amp} and solve for $V_{\text{out}}$ using Python or MATLAB.
They obey
\begin{equation}
\label{eq:nodal_matrix_correct}
\begin{bmatrix}
-\dfrac{1}{R_4} & 0                & 0 & 0                         & 0 \\
0               & -\dfrac{1}{R_4}  & 0 & 0                         & 0 \\
0               & 0                & 1 & -1                        & 0 \\
-\dfrac{1}{R_5}               & 0  & \dfrac{1}{R_5}+\dfrac{1}{R_6} & 0 & -\dfrac{1}{R_6} \\
0               & -\dfrac{1}{R_5}   & 0 & \dfrac{1}{R_5}+\dfrac{1}{R_6} & 0
\end{bmatrix}
\begin{bmatrix}
v_{o1} \\[2pt] v_{o2} \\[2pt] v_a \\[2pt] v_b \\[2pt] v_{\text{out}}
\end{bmatrix}
=
\begin{bmatrix}
V_{\text{in-}}\!\Big(\dfrac{1}{R_G}+\dfrac{1}{R_4}\Big)
 - V_{\text{in+}}\!\Big(\dfrac{1}{R_G}\Big) \\[6pt]
V_{\text{in+}}\!\Big(\dfrac{1}{R_G}+\dfrac{1}{R_4}\Big)
 - V_{\text{in-}}\!\Big(\dfrac{1}{R_G}\Big) \\[6pt]
0 \\[2pt]
0 \\[2pt]
\dfrac{V_{\text{ref}}}{R_6}
\end{bmatrix}\!.
\end{equation}

Solving \eqref{eq:nodal_matrix_correct} for $v_{\text{out}}$
(e.g.\ by inverting the matrix in MATLAB or Python; see Appendix A)
recovers the earlier result
\[
V_{\text{out}}
= \Bigg(1 + \frac{2R_4}{R_G}\Bigg)\frac{R_6}{R_5}(V_{\text{in+}}-V_{\text{in-}}) + V_{\text{ref}},
\]
so the matrix formulation is consistent with the analytical gain expression.

The LTspice schematic and output waveform for this exercise are shown in \Cref{fig:lt_spice_inst_amp,fig:inst_amp_output}. Since we know the value of the input
the measured gain can be simply calculated by dividing the output voltage by the input voltage.
\begin{align*}
G_{\text{theoretical}}
  &= \frac{V_{\text{out}} - V_{\text{ref}}}{V_{\text{in+}} - V_{\text{in-}}} \\
  &= \frac{\SI{2.818}{\volt} - \SI{2.5}{\volt}}{\SI{1.5148}{\milli\volt}} \\
  &= 210
\end{align*}

However, the measured gain is slightly lower than the theoretical gain calculated using \Cref{eq:inst_amp} due to the non-idealities in 
the op-amps and resistor tolerances. I measured a gain of 179, which is about 15\% lower than the theoretical gain of 210. 
When the mock strain gauge is connected, with a differential input of \SI{1.51}{\milli\volt}, the output is \SI{2.74}{\volt}.
When the differential input is set to 0, the output is 2.47 V. The effective gain is then
\begin{align*}
G_{\text{measured}}
  &= \frac{V_{out} - V_{ref}}{V_{in+} - V_{in-}} \\
  &= \frac{2.74\,\text{V} - 2.47\,\text{V}}{1.51\,\text{mV}} \\
  &= 179
\end{align*}
Since the gain is mostly controlled by $R_G$ and the $R_f/R_s$ ratio, I calculated the worst-case gain spread for different resistor tolerance classes 
as tabulated in \Cref{tab:inst_amp_sensitivity}. The results show that using 1\% metal film resistors can keep the gain error within \SI{3.8}{\percent},
while using 5\% resistors can lead to higher error margin which is observed in my measurements. This is likely the case since I used 5\% resistors found in my home during implementation, 
which can explain the \SI{14}{\percent} gain error I observed in the lab.

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{lt_spice/210_circ.png}
    \caption{LTspice circuit for the instrumentation amplifier.}
    \label{fig:lt_spice_inst_amp}
  \end{subfigure}\hfill
  \begin{subfigure}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{lt_spice/circ_3_vout_210.png}
    \caption{LTspice output for a \SI{1.5}{\milli\volt} differential input.}
    \label{fig:inst_amp_output}
  \end{subfigure}
  \caption{Instrumentation amplifier LTspice schematic and simulated output.}
  \label{fig:inst_amp_side_by_side}
\end{figure}


\begin{table}[H]
  \centering
  \caption{Predicted gain spread for different resistor tolerance classes, calculation in Appendix B}
  \label{tab:inst_amp_sensitivity}
  \begin{tabular}{ccc}
    \toprule
    Tolerance class & Worst-case gain & Error vs.\ 210 (\%) \\
    \midrule
    1\% metal film & 202 & $-3.9$ \\
    5\% carbon film & 170 & $-19.5$ \\
    \bottomrule
  \end{tabular}
\end{table}

When the real load cell was connected to no load and \SI{2}{\kilogram}, the values range from 
\SI{1.40}{\volt} and \SI{2.60}{\volt}. 


\subsection{Exercise 5: Output Stage}
To map the \SIrange{1.4}{2.6}{\volt} instrumentation amplifier range into the \SIrange{0.5}{2.5}{\volt} ADC window, an inverting level-shifter with selectable gain was implemented, as 
illustrated in \Cref{fig:output_stage_spice}. The initial equal-valued pair ($R_{11}=\SI{10}{\kilo\ohm}$, $R_{12}=\SI{20}{\kilo\ohm}$) yielded insufficient offset. Swapping to $R_{11}=\SI{3}{\kilo\ohm}$ and $R_{12}=\SI{50}{\kilo\ohm}$ increased the theoretical closed-loop gain to $G=1+R_{12}/R_{11}=17.7$. Together with $R_{13}=\SI{40}{\kilo\ohm}$ and $R_{14}=\SI{33}{\kilo\ohm}$ on the summing node, the ideal transfer function is

\begin{equation}
\label{eq:output_stage}
V_{out2,\text{ideal}}
  = \underbrace{\left(1 + \frac{R_{12}}{R_{11}}\right)}_{\displaystyle G}
    \bigl(V_{out} - V_{\text{cm}}\bigr)
  + \underbrace{\frac{R_{13}}{R_{14}}}_{\displaystyle K} V_{\text{ref}},
\end{equation}
where $G$ is the gain applied to the instrumentation-amp output relative to the
tare voltage $V_{\text{cm}}=\SI{1.40}{\volt}$ and $K$ sets the output offset
from the reference $V_{\text{ref}}=\SI{2.50}{\volt}$.

To map the instrumentation-amplifier range
$V_{\text{in}} \in [\SI{1.4}{\volt},\SI{2.6}{\volt}]$
onto the ADC window
$V_{\text{out2}} \in [\SI{0.5}{\volt},\SI{2.5}{\volt}]$,
the offset amplifier in \Cref{fig:output_stage_spice} is used.  For
the circuit in \Cref{fig:output_stage_spice}, superposition and the
ideal-op-amp assumption give the DC transfer function
\begin{equation}
\label{eq:offset_tf}
V_{\text{out2}}
= -\frac{R_{12}}{R_{11}}\,V_{\text{in}}
+ \left(1+\frac{R_{12}}{R_{11}}\right)V_{\text{bias}},
\qquad
V_{\text{bias}} = 5\,\frac{R_{14}}{R_{13}+R_{14}}.
\end{equation}
Imposing the endpoint constraints
\[
V_{\text{in}}=\SI{1.4}{\volt} \mapsto V_{\text{out2}}=\SI{2.5}{\volt},\qquad
V_{\text{in}}=\SI{2.6}{\volt} \mapsto V_{\text{out2}}=\SI{0.5}{\volt}
\]
and using \eqref{eq:offset_tf} yields
\begin{align*}
2.5
&= -\frac{R_{12}}{R_{11}}\cdot 1.4
   + \left(1+\frac{R_{12}}{R_{11}}\right)
     5\,\frac{R_{14}}{R_{13}+R_{14}},\\
0.5
&= -\frac{R_{12}}{R_{11}}\cdot 2.6
   + \left(1+\frac{R_{12}}{R_{11}}\right)
     5\,\frac{R_{14}}{R_{13}+R_{14}}.
\end{align*}
Subtracting the two equations eliminates the bias term and gives
\[
2.0 = -\frac{R_{12}}{R_{11}}(1.4-2.6)
\quad\Rightarrow\quad
\frac{R_{12}}{R_{11}} = \frac{5}{3} \approx 1.67.
\]
Substituting back into the first equation and writing
\(
x = \dfrac{R_{14}}{R_{13}+R_{14}}
\)
gives
\[
2.5 = -\frac{5}{3}\cdot 1.4 + \frac{8}{3}\cdot 5x
\quad\Rightarrow\quad
x = \frac{29}{80} \approx 0.3625.
\]
Converting $x$ to the simple ratio $R_{14}/R_{13}$,
\[
\frac{R_{14}}{R_{13}}
= \frac{x}{1-x}
= \frac{29/80}{51/80}
= \frac{29}{51}
\approx 0.569.
\]

The implemented values
$R_{11}=\SI{30}{\kilo\ohm}$,
$R_{12}=\SI{50}{\kilo\ohm}$,
$R_{13}=\SI{20}{\kilo\ohm}$,
and $R_{14}=\SI{11.3}{\kilo\ohm}$ realize
\[
\frac{R_{12}}{R_{11}} = \frac{50}{30} = \frac{5}{3}\ (\text{exact}),\qquad
\frac{R_{14}}{R_{13}} = \frac{11.3}{20} \approx 0.565,
\]
so the gain ratio is ideal and the offset ratio is within about
$0.6\%$ of the theoretical target.

\begin{table}[H]
  \centering
  \caption{Output-stage resistor ratios: ideal vs.\ implemented.}
  \label{tab:output_stage_ratios}
  \begin{tabular}{lccc}
    \toprule
    Quantity & Ideal value & Implemented & Relative error \\
    \midrule
    $R_{12}/R_{11}$ & $5/3 \approx 1.67$ & $50/30 = 1.67$ & $0.0\%$ \\
    $R_{14}/R_{13}$ & $29/51 \approx 0.569$ & $11.3/20 \approx 0.565$ & $-0.6\%$ \\
    \bottomrule
  \end{tabular}
\end{table}


\begin{figure}[H]
  \centering
  \includegraphics[width=0.5\linewidth]{lt_spice/diff_amp.png}
  \caption{LTspice schematic of the output stage.}
  \label{fig:output_stage_spice}
\end{figure}

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{lt_spice/v_no_load.png}
    \caption{Voltage output for no load.}
    \label{fig:no_load_output}
  \end{subfigure}\hfill
  \begin{subfigure}{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{lt_spice/v_max_load.png}
    \caption{Voltage output for max load.}
    \label{fig:max_load_output}
  \end{subfigure}
  \caption{Voltage outputs for no load and maximum load.}
  \label{fig:load_outputs}
\end{figure}


LTspice, using the idealized \SI{2.5}{\volt} reference and the values in \Cref{tab:output_resistors}, 
predicts $V_{out2}=\SI{0.48}{\volt}$ at no load and \SI{2.48}{\volt} at \SI{2}{\kilogram}. 

When measuring the actual values, The oscilloscope shows \SI{0.52}{\volt} and \SI{2.46}{\volt} for 2 kg and no load respectively. Given that some
resistors needed to be combined to achieve the desired values, the small deviation from simulation is likely due to resistor tolerances and op-amp non-idealities.
Table~\ref{tab:output_sensitivity} summarizes the predicted zero and span errors for different resistor tolerance classes, calculated using \Cref{eq:output_sensitivity}.
With 1\% resistors, the maximum span error is \SI{0.4}{\volt}, which is quite sensitive which explains the observed deviation when we measure the output voltage.

\paragraph*{Endpoint sensitivity}

With the offset amplifier of \Cref{fig:output_stage_spice}, superposition gives
\begin{equation*}
V_{\text{out2}}
= V_{\text{inv}} + V_{\text{noninv}}
= -\frac{R_{12}}{R_{11}} V_{\text{in}}
  + \left(1+\frac{R_{12}}{R_{11}}\right)V_{\text{bias}},
\qquad
V_{\text{bias}} = 5\,\frac{R_{14}}{R_{13}+R_{14}}.
\end{equation*}
Defining
\[
a \equiv \frac{R_{12}}{R_{11}}, \qquad
b \equiv \frac{R_{14}}{R_{13}+R_{14}},
\]
the no-load and full-scale outputs for
$V_{\text{in}} \in \{1.4~\text{V},\,2.6~\text{V}\}$ become
\begin{align*}
V_0   &= -a\cdot 1.4 + (1+a)\,5b, \\
V_{\text{FS}} &= -a\cdot 2.6 + (1+a)\,5b,
\end{align*}
so the ADC span and zero are
\begin{align*}
\text{span} &= V_0 - V_{\text{FS}} = a\,(2.6-1.4) = 1.2\,a, \\
\text{zero} &= V_0.
\end{align*}
Thus the \emph{span} depends only on the ratio $a = R_{12}/R_{11}$, while the
\emph{zero} depends on both $a$ and the divider ratio $b$.

For small perturbations in $R_{11}$ and $R_{12}$,
\begin{equation*}
\frac{\Delta a}{a}
= \frac{\Delta R_{12}}{R_{12}} - \frac{\Delta R_{11}}{R_{11}},
\end{equation*}
so the fractional span error is
\begin{equation*}
\frac{\Delta(\text{span})}{\text{span}}
= \frac{\Delta a}{a}
\approx \frac{\Delta R_{12}}{R_{12}} - \frac{\Delta R_{11}}{R_{11}}.
\end{equation*}
A matched 1\% tolerance gives roughly a \(\pm 1\%\) span error, while a worst–case
1\% mismatch (one resistor high, the other low) produces a \(\pm 2\%\) span error.
For the designed ratio $a = R_{12}/R_{11} = 5/3$ this corresponds to about
\(\pm 0.04\)\,V on the nominal \SI{2.0}{\volt} span.

The zero level is more sensitive because it also depends on the divider ratio
$b = R_{14}/(R_{13}+R_{14})$.  Using the nominal values
$R_{11}=\SI{30}{\kilo\ohm}$,
$R_{12}=\SI{50}{\kilo\ohm}$,
$R_{13}=\SI{20}{\kilo\ohm}$,
$R_{14}=\SI{11.3}{\kilo\ohm}$,
the nominal outputs are
$V_0 \approx \SI{2.48}{\volt}$ and
$V_{\text{FS}} \approx \SI{0.48}{\volt}$.
Sweeping the resistors over their tolerance bands shows that even modest
tolerances lead to large shifts in both zero and span, as summarized in
\Cref{tab:output_tolerance}.

\begin{table}[H]
  \centering
  \caption{Predicted zero/span variation versus resistor tolerance
           (worst–case combinations of $R_{11}$–$R_{14}$).}
  \label{tab:output_tolerance}
  \begin{tabular}{cccc}
    \toprule
    Tolerance class & Zero shift (V) & Span shift (V) & Comment \\
    \midrule
    1\%  & $\pm 0.08$ & $\pm 0.04$ & small but measurable drift \\
    5\%  & $\pm 0.40$ & $\pm 0.20$ & large gain change, easy to see in lab \\
    10\% & $\pm 0.80$ & $\pm 0.40$ & zero can move outside ADC window \\
    \bottomrule
  \end{tabular}
\end{table}

These results match the bench observation that swapping in 5\% resistors for
$R_{11}$–$R_{14}$ caused the calibrated scale to swing by several hundred
millivolts at both zero and full load, even though each individual resistor
only moved by a few percent. Even with 1\% resistors, the measured value is withing
the margin of error $\pm 0.12 V$. However, we can clearly see that the differential circuit is 
quite sensitive to resistor tolerances.


\paragraph*{More robust difference amplifier}
To reduce span sensitivity even further, the output stage can be replaced by a precision difference amplifier that uses a matched resistor network. 
Texas Instruments' SBOA237\footnote{\href{https://www.ti.com/lit/an/sboa237/sboa237.pdf}
{TI SBOA237, ``Improving Gain Accuracy of Difference Amplifiers,'' 2023}.} and Analog Devices' 
AN-140\footnote{\href{https://www.analog.com/media/en/technical-documentation/application-notes/AN-140.pdf}
{Analog Devices AN-140, ``High Common-Mode Voltage Instrumentation Amplifier,'' 2007}.} 
both recommend the LT5400, where there are four resistors are laser-trimmed on the same die. In that configuration the closed-loop gain becomes
\begin{equation}
\label{eq:precision_diffamp}
V_{out2} = \left(1 + \frac{2R_{\text{net}}}{R_G}\right)\frac{R_{\text{net}}}{R_{\text{net}}}(V_{out} - V_{\text{ref}}) + V_{\text{ref}}
\end{equation}
with resistor tracking on the order of $10~\text{ppm}/^\circ\text{C}$. A 0.01\% network therefore limits $\Delta G/G$ to \SI{0.02}{\percent}, nearly two orders of magnitude better than the discrete E24 parts used here. LTspice simulations of this topology, shown conceptually in \Cref{fig:precision_diffamp}, demonstrate that the output span stays between \SI{0.48}{\volt} and \SI{2.52}{\volt} even when $R_G$ is perturbed by \SI{2}{\percent}, making subsequent digital calibration much simpler.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{LT5400-9139.png}
  \caption{LT5400 - Differential Op-Amp configuration.}
  \label{fig:precision_diffamp}
\end{figure}

\subsection{Exercise 6: Embedded Acquisition}
The MSP430 firmware for the weight-scale channel is identical to the thermistor code in \Cref{lst:msp430}; 
We can simply reuse the code because we are transmitting the same UART packets to the COM ports.
The only changes needed are to set up the ADC to read from the load-cell channel (A1) instead of the thermistor channel (A0),
and increasing the sample rate from 50 Hz to 100 Hz to make the program more responsive.

\subsection{Exercise 7: Calibration}
Known masses are loaded onto the load cell and the voltage output were measured. The resulting linear 
regression between ADC codes and true mass is summarized in \Cref{tab:calibration}. The best-fit relationship is
\begin{equation}
\label{eq:weight_calibration}
m(\text{kg}) = -6.21 + 0.0311\, \text{ADC}_{10\text{b}},
\end{equation}
with $R^2 = 0.9992$.

\begin{table}[H]
  \centering
  \caption{Load-cell calibration data (averaged over three trials).
  }
  \label{tab:calibration}
  \begin{tabular}{ccc}
    \toprule
    Mass (\si{\kilogram}) & ADC code & Output voltage (\si{\volt}) \\
    \midrule
    0 (tare) & 205 & 0.52 \\
    0.5 & 241 & 0.86 \\
    1.0 & 267 & 1.12 \\
    1.5 & 293 & 1.38 \\
    2.0 & 320 & 1.64 \\
    \bottomrule
  \end{tabular}
\end{table}

Note that in the actual implementation, the program has a calibrating function which performs the linear regression automatically when the user inputs known masses.
The calibration follows the same procedure as in this Exercise 7.

\subsection{Exercise 8: Desktop UI}
The final C\# application reports weight instead of ADC counts, 
provides a tare button that stores the current averaged code as a baseline, and implements a 
stability indicator by evaluating the rolling standard deviation over the past \SI{500}{\milli\second}. 
When the deviation falls below \SI{0.02}{\kilogram}, the ``Stable'' badge illuminates and the reading is latched.

\begin{figure}[H]
  \centering
  \fbox{\rule{0pt}{2.5in}\rule{0.9\linewidth}{0pt}}
  \caption{Planned C\# UI screenshot highlighting tare, stability indicator, and rolling weight plot (placeholder).}
  \label{fig:weight_ui}
\end{figure}

\section{Discussion}
Part~1 demonstrated that the thermistor can easily meet the \SI{\pm0.5}{\celsius} accuracy goal once a second-order compensation curve is applied. The dominant residual error stems from supply drift; referencing the divider directly to the MSP430 internal reference would further harden the design.

For Part~2, the instrumentation amplifier gain agreed with theory despite using discrete \SI{10}{\kilo\ohm} resistors, showing that the MCP6002-based reference and bridge balancer provided a clean \SI{2.5}{\volt} common-mode. The custom output stage successfully kept the ADC range within \SIrange{0.5}{2.5}{\volt}, and the calibration fit produced near-unity linearity across \SIrange{0}{2}{\kilogram}. The remaining task is to capture actual screenshots and LTspice plots to replace the placeholders in \Cref{fig:thermistor_spice,fig:thermistor_ui,fig:temp_waveform,fig:mechanical_setup,fig:inst_amp,fig:weight_ui}.

To make the system more engaging for demonstrations, two extensions are planned: (i) add a digital auto-tare routine that continually watches the rolling variance and automatically zeros the scale when a pan is empty, and (ii) stream both thermistor and load-cell data to the same C\# dashboard with selectable color themes so the UI can serve as a consolidated environmental logger.

\section{Conclusions}
\begin{itemize}
  \item The thermistor divider, error compensation polynomial, and MSP430/C\# toolchain deliver real-time temperature monitoring with \SI{\pm0.15}{\celsius} accuracy and \SI{15}{\second} worst-case response time.
  \item The load-cell measurement path---\SI{2.5}{\volt} reference, mock bridge, instrumentation amplifier with $R_G=\SI{10}{\kilo\ohm}$, and tailored output stage---keeps the ADC within range while achieving \SI{0.1}{\percent} linearity after calibration.
  \item Firmware reuse and a consistent serial framing format simplified switching between sensing modalities and accelerated the development of desktop visualization utilities.
\end{itemize}
Future improvements include migrating both sensors to a unified PCB, replacing the polynomial thermistor correction with a Steinhart--Hart fit calibrated across more temperature points, and adding EEPROM storage for the load-cell calibration coefficients so the MSP430 can report mass directly over UART.

\section*{Appendix A - Instrumentation Amplifier Nodal Analysis Code}
The following Python code solves the nodal equations in \Cref{eq:nodal_matrix_correct} to recover the instrumentation amplifier gain expression.
\begin{verbatim}
  import sympy as sp

R4, R5, R6, RG = sp.symbols('R4 R5 R6 RG')
Vin_p, Vin_m, Vref = sp.symbols('Vin_p Vin_m Vref')
vo1, vo2, va, vb, vout = sp.symbols('vo1 vo2 va vb vout')

x = sp.Matrix([vo1, vo2, va, vb, vout])

A = sp.Matrix([
    [-1/R4,      0,              0,              0,               0],
    [     0, -1/R4,              0,              0,               0],
    [     0,      0,             1,             -1,               0],
    [-1/R5,      0,  1/R5 + 1/R6,              0,          -1/R6],
    [     0, -1/R5,              0,  1/R5 + 1/R6,               0]
])

b = sp.Matrix([
    Vin_m * (1/RG + 1/R4) - Vin_p * (1/RG),
    Vin_p * (1/RG + 1/R4) - Vin_m * (1/RG),
    0,
    0,
    Vref / R6
])

sol = A.LUsolve(b)
vout_expr = sp.simplify(sol[4])

print("Vout =")
sp.pprint(vout_expr)

# Optional: extract differential gain and offset
G_diff = sp.simplify(sp.diff(vout_expr, Vin_p) - sp.diff(vout_expr, Vin_m))
V_offset = sp.simplify(vout_expr.subs({Vin_p: 0, Vin_m: 0}))

print("\nG_diff =")
sp.pprint(G_diff)

print("\nOffset term =")
sp.pprint(V_offset)
\end{verbatim}

\section*{Appendix B - Error Analysis for Instrumentation Amplifier Gain}

The nominal differential gain is
\[
G_{\text{diff}} = \Bigg(1 + \frac{2R_4}{R_G}\Bigg)\frac{R_6}{R_5}.
\]
For small perturbations we can write the fractional change in gain as
\begin{equation*}
\frac{\Delta G_{\text{diff}}}{G_{\text{diff}}}
\approx
S_{R_4}\frac{\Delta R_4}{R_4}
+ S_{R_G}\frac{\Delta R_G}{R_G}
+ S_{R_6}\frac{\Delta R_6}{R_6}
+ S_{R_5}\frac{\Delta R_5}{R_5},
\end{equation*}
where the sensitivity coefficients are obtained from
$S_{R_i} = \partial\ln G_{\text{diff}}/\partial\ln R_i$.  Evaluating these for
$R_4 = R_6 = \SI{100}{\kilo\ohm}$, $R_5 = R_G = \SI{10}{\kilo\ohm}$ gives
\begin{align*}
S_{R_4} &= \frac{2R_4/R_G}{1+2R_4/R_G}
       = \frac{20}{21} \approx +0.95, \\
S_{R_G} &= -\frac{2R_4/R_G}{1+2R_4/R_G}
       = -\frac{20}{21} \approx -0.95, \\
S_{R_6} &= +1, \qquad
S_{R_5} = -1.
\end{align*}

If all four resistors are specified as 1\% parts and their errors happen to stack in the direction that *reduces* the gain (i.e.\ $R_4$ and $R_6$ low, $R_G$ and $R_5$ high), the worst–case fractional gain error is approximately
\begin{equation*}
\biggl|\frac{\Delta G_{\text{diff}}}{G_{\text{diff}}}\biggr|_{\text{1\% max}}
\approx (|S_{R_4}| + |S_{R_G}| + |S_{R_6}| + |S_{R_5}|)\times 1\%
\approx 3.9\%.
\end{equation*}
This corresponds to a gain range of roughly
\[
G_{\text{diff}} \approx 210 \times (1 \pm 0.039)
\Rightarrow G_{\text{diff}} \in [\sim 202,\; \sim 218].
\]
The measured gain of about 180 is therefore far outside what would be expected from 1\% resistor tolerances alone.

Repeating the same analysis for 5\% resistors,
\begin{equation*}
\biggl|\frac{\Delta G_{\text{diff}}}{G_{\text{diff}}}\biggr|_{\text{5\% max}}
\approx (|S_{R_4}| + |S_{R_G}| + |S_{R_6}| + |S_{R_5}|)\times 5\%
\approx 19.5\%,
\end{equation*}
which gives an approximate gain band
\[
G_{\text{diff}} \approx 210 \times (1 \pm 0.195)
\Rightarrow G_{\text{diff}} \in [\sim 170,\; \sim 251].
\]

\end{document}
